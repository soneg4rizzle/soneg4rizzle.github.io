---
title: (HTB - Linux) Strutted 
categories: [Playground, Hack The Box]
tags: [HTB, WriteUp]
image:
  path: /assets/post/2025/Playground/Hack The Box/thumb.png
  alt: Strutted / Linux / Medium
published: false
---

<img src='assets/post/2025/Playground/Hack The Box/Strutted/0.png' width=1200 alt=''>

# INFORMATION GAHTERING
## PORT SCANNING
### NMAP - TCP PORTS

- 개방된 TCP 포트 : 22, 80  

```zsh
└─# nmap -p- -sC -sV -Pn -n --min-rate 10000 10.129.67.51 -oN 10.129.67.51_TCP
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-08 05:53 EDT
Warning: 10.129.67.51 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.129.67.51
Host is up (0.26s latency).
Not shown: 64769 closed tcp ports (reset), 764 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://strutted.htb/
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 31.38 seconds
```

### NMAP - TCP PORTS

- 개방된 UDP 포트는 존재하지 않았다.

```zsh
└─# nmap -sU -sV -Pn -n --top-ports 100 --min-rate 10000 10.129.67.51 -oN 10.129.67.51_UDP
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-08 05:53 EDT
Nmap scan report for 10.129.67.51
Host is up (0.26s latency).
Not shown: 95 open|filtered udp ports (no-response)
PORT     STATE  SERVICE VERSION
49/udp   closed tacacs
427/udp  closed svrloc
520/udp  closed route
2049/udp closed nfs
5060/udp closed sip

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 427.37 seconds
```

---

## PORT 80

- 80번 포트로 접근 시 `http://strutted.htb` 경로로 리다이렉트 되며 접속이 불가하다.  
- 해당 포트로 접근하기 위해 `/etc/hosts` 파일에 대상 호스트의 IP 주소와 도메인 주소를 맵핑한다.  

```zsh
└─# cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters
10.129.67.51    
```

<br>

- `Upload` 기능을 통해 임의의 파일 업로드 시도 시 지정된 확장자 파일만 서버에 업로드 가능한 것을 확인했다.  

<img src='assets/post/2025/Playground/Hack The Box/Strutted/1.png' width=1200 alt=''>

<br>

- 추가로, 우측 상단의 `Download` 클릭하여 `strutted.zip` 압축파일 다운로드 후 정보를 수집했다.

<img src='assets/post/2025/Playground/Hack The Box/Strutted/2.png' width=1200 alt=''>

<br>

- [1] `tomcat-users.xml` : 톰캣 관리자 계정정보 확인 (80번 포트는 nginx 웹서버이므로 해당되지 않지만 타겟 내부에서만 접근 가능한 서비스가 있는 경우 해당 정보를 활용해볼 수 있음)  

```zsh
└─# cat tomcat-users.xml                      
<?xml version='1.0' encoding='utf-8'?>

<tomcat-users>
    <role rolename="manager-gui"/>
    <role rolename="admin-gui"/>
    <user username="admin" password="skqKY6360z!Y" roles="manager-gui,admin-gui"/>
</tomcat-users>
```

<br>

- [2] `pom.xml` : 웹 애플리케이션 개발에 사용된 프레임워크(apache struts2)에 대한 정보를 획득했다.  
  - `<struts2.version>6.3.0.1</struts2.version>`  
- [3] 해당 버전은 [CVE-2024-53677](https://www.skshieldus.com/kor/eqstinsight/cve2501.html)에 취약한 버전이었다.  
- [4] 위 CVE를 이용하기 위해서는 서버 측에 악성 파일 업로드가 우선적으로 필요하다. 따라서, `strutted.zip` 압축파일 안에 들어있던 소스파일을 분석하여 파일 업로드 검증 우회가 가능한 포인트를 확인한다.  

<br>

---

## VULNERABILITY ASSESSMENT
### Bypass - File Upload  

- [1] `/strutted/src/main/webapp/WEB-INF/upload.jsp` 소스를 살펴보면, 파일 업로드 시 `upload` 라는 이름의 액션이 실행된다. 이는 Apache Struts2 프레임워크에서 제공하는 태그(`<s:form>, <s:file>, <s:submit>`)를 사용한 파일 업로드 폼이므로 `struts.xml` 설정파일을 통해 사전에 정의된 호출 로직을 확인해야 한다.

<img src='assets/post/2025/Playground/Hack The Box/Strutted/3.png' width=1200 alt=''>

<br>

- [2] `/strutted/src/main/resources/struts.xml` 파일을 통해 upload 요청이 들어오면 org.strutted.htb.Upload 파일이 호출되는 구조를 확인할 수 있다.

<img src='assets/post/2025/Playground/Hack The Box/Strutted/4.png' width=1200 alt=''>


<br>

- [3] `/strutted/src/main/java/org/strutted/htb/Upload.java` 파일을 살펴보면 `upload.jsp`에서 `upload` 액션이 호출되었을 때, 해당 파일의 `Upload` 클래스 객체가 생성되고 `execute` 메서드가 실행되는 로직을 확인할 수 있다.  
- [4] `Upload.java` 파일을 살펴보면 `uploadFileName` 이라는 파라미터로 받은 값이 존재하는 경우에 업로드 파일의 확장자로 사용하는 구조를 확인할 수 있다. 

<img src='assets/post/2025/Playground/Hack The Box/Strutted/5.png' width=1200 alt=''>


<br>

---


# Reference
1. https://struts.apache.org/maven/struts2-core/apidocs/org/apache/struts2/interceptor/FileUploadInterceptor.html
2. https://www.skshieldus.com/kor/eqstinsight/cve2501.html















- [3] struts2 버전은 `strutted/target/strutted-1.0.0/WEB-INF/lib/struts2-core-6.3.0.1.jar` 경로에 위치한 `jar` 파일을 압축해제하여 확인할 수 있다.

<img src='assets/post/2025/Playground/Hack The Box/Strutted/3.png' width=1200 alt=''>

```zsh
└─# ls                                                                                                                      
author.dtd              NOTICE.txt        struts-2.5.dtd                        tomcat-users.xml
cat2.png                OGNL-LICENSE.txt  struts-6.0.dtd                        xwork-default.xml
cat.png                 org               struts-beans.xml                      XWORK-LICENSE.txt
com                     overview.html     struts-default-conversion.properties  xwork-validator-1.0.2.dtd
context.xml             README.md         struts-default.xml                    xwork-validator-1.0.3.dtd
Dockerfile              recon             struts-excluded-classes.xml           xwork-validator-1.0.dtd
FREEMARKER-LICENSE.txt  struts-2.0.dtd    struts.vm                             xwork-validator-config-1.0.dtd
jshint.conf.js          struts-2.1.7.dtd  strutted                              xwork-validator-definition-1.0.dtd
LICENSE.txt             struts-2.1.dtd    strutted.zip                                                                      
META-INF                struts-2.3.dtd    template

[ . . . ]

└─# cat MANIFEST.MF                                                        
Manifest-Version: 1.0                                                                                                       
Implementation-Title: Struts 2 Core                                                                                         
Bundle-Description: Apache Struts 2
Bundle-License: https://www.apache.org/licenses/LICENSE-2.0.txt
Bundle-SymbolicName: org.apache.struts.2-core
Implementation-Version: 6.3.0.1 
Specification-Vendor: Apache Software Foundation
Bundle-ManifestVersion: 2
Specification-Title: Struts 2 Core
Bundle-DocURL: https://www.apache.org
Bundle-Vendor: Apache Software Foundation
[ . . . ]
Bundle-Name: Struts 2 Core
Bundle-Version: 6.3.0.1
Build-Jdk-Spec: 1.8
Created-By: Apache Maven Bundle Plugin 5.1.9
Specification-Version: 0.0
```
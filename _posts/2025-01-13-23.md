---
title: JSP content-type configuration
categories: [Notes, Cheat Sheet]
tags: [Cheat Sheet, JSP Content-Type]
image:
  path: /assets/post/2025/Notes/Cheat Sheet/JSP.png
  alt: JSP Content-Type Configuration
published: true
---

## JSP Content-Type Configuration
웹 애플리케이션 취약점 진단을 수행할 때 반드시 확인해야 할 취약점으로 파일 업로드 취약점이 있습니다.
파일 업로드 취약점은 웹 서버에 악성 파일(웹 쉘)을 업로드하고 해당 경로로 접근하여 실행할 수 있어야 하는데요.
이를 위해서는 아래와 같은 조건이 필요합니다.

> 1. 서버 사이드 스크립트 확장자(PHP, JSP, ASP) 업로드가 가능해야 합니다.
> 2. 파일의 업로드 경로 및 파일명을 확인 가능해야 하며 해당 경로로 접근이 가능해야 합니다.
> 3. 업로드 파일 폴더에 파일 실행 권한이 설정되어 있어야 합니다.

파일이 업로드 되더라도 해당 파일이 **실행되지 않도록 처리하면** 공격 페이로드로부터 안전하다고 볼 수 있습니다. 때문에 웹서버/WAS에서 자체적인 설정을 통해 파일을 텍스트 타입(text/plain)으로 인식하도록 설정하는 방식이 흔히 사용됩니다.  

```apache
[Apache - .httaccess]
AddType text/plain .html .js .css .txt .xml

[Apache - httpd.conf]
<Directory "/path/to/your/folder">
    AddType text/plain .html .js .css .txt .xml
</Directory>
```

---

```nginx
[Nginx - nginx.conf]
server {
    location /your-folder/ {
        types {
            text/plain html js css txt xml;
        }
    }
}
```

---

```apache
[Apache Tomcat - web.xml]
<mime-mapping>
    <extension>html</extension>
    <mime-type>text/plain</mime-type>
</mime-mapping>
<mime-mapping>
    <extension>js</extension>
    <mime-type>text/plain</mime-type>
</mime-mapping>
```

스프링 환경으로 구축된 웹 사이트에 JSP 확장자를 업로드하고 해당 경로에 접근해보면 응답 패킷에서 Content-Type 이 text/plain 으로 설정된 경우가 있는데요. 이는 웹 서버에서 자체적으로 해당 파일을 텍스트(평문)으로 인식해서 실행될 수 없도록 처리하기 때문일 가능성이 있습니다.  

응답값의 컨텐트 타입이 `text/plain`으로 설정된 경우, 삽입된 구문이 텍스트로 인식되기 때문에 해당 파일이 업로드 된 경로로 직접 접근하더라도 서버 사이드 스크립트 언어가 실행되지는 않는데요.  

업로드된 .jsp 파일이 서버에서 여전히 JSP 전용 처리 규칙(서블릿 매핑)에 따라 처리되도록 설정되어 있다면, 파일 안의 서버 코드가 실행될 수 있습니다. 예를 들어, 공격자가 example.jsp를 업로드한 뒤 URL이나 파라미터를 통해 이 파일에 접근하면, 서버는 JSP 코드를 해석하고 실행할 수 있습니다.  

따라서, 단순히 Content-Type을 text/plain으로 설정했다고 해서 완전히 안전한 것이 아니라 서버 설정에 따라 업로드된 JSP가 여전히 동작할 수 있으므로 꼭 사용이 필요한 확장자만 화이트리스트 방식으로 허용하는 방식으로 파일 업로드를 제한하여 관리하여야 합니다.  

```
1. 화이트 리스트 확장자 검증 (업로드 허용 확장자 설정)  
2. 업로드 폴더 내 파일 실행권한 제거 (서버 사이드 확장자 업로드 되더라도 실행 불가하도록 조치)  
3. 업로드 폴더를 웹 루트 디렉토리 외부로 설정 (웹 서비스에서 중요파일 직접 접근 불가하도록 설정)  
4. 폴더명/파일명을 해시 테이블로 관리 (서버 내 중요파일 직접 접근 불가하도록 설정)  
5. ETC. (조치할 수 있는 방법은 다양하다.)
```

---

## Reference
1. https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-CORS-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95-%F0%9F%91%8F
2. https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-CORS-%EB%B3%B4%EC%95%88-%EC%B7%A8%EC%95%BD%EC%A0%90-%EC%98%88%EB%B0%A9-%EA%B0%80%EC%9D%B4%EB%93%9C
3. https://h0-0cat.tistory.com/entry/6%EC%9B%947%EC%9D%BC-%EC%98%A4%EC%A0%84-%EC%8B%9C

---

<h2 style="text-align: center;" data-ke-size="size26"><b>END</b></h2>